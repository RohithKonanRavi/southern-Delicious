version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.11
    commands:
    - uname -m
    - echo "Installing pylint..."
    - pip install pylint
    - echo "Downloading and setting up SonarScanner CLI..."
    - wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip
    - unzip sonar-scanner-cli-5.0.1.3006-linux.zip
    - mv sonar-scanner-5.0.1.3006-linux /opt/
    - export PATH=$PATH:/opt/sonar-scanner-5.0.1.3006-linux/bin
    - export SONAR_SCANNER_HOME=/opt/sonar-scanner-5.0.1.3006-linux
    - export JAVA_HOME=$SONAR_SCANNER_HOME/jre
    - echo "Configuring SonarScanner CLI environment variables..."
    - echo "path"
    - echo "$PATH"
    - echo "SONAR_SCANNER_HOME"
    - echo "$SONAR_SCANNER_HOME"
    - echo "JAVA_HOME"
    - echo "$JAVA_HOME"
    - echo "Verifying SonarScanner and Java setup..."
    - sonar-scanner -v
    - java -version
    - ls -lrt /opt/sonar-scanner-5.0.1.3006-linux/bin

  pre_build:
    commands:
    - echo "Pre-build step; install project dependencies..."
    - pip install -r requirements.txt

  build:
    commands:
    - echo "Running pylint..."
    - pylint --exit-zero accounts/ main/ southern_delicious/
    - echo "Running sonar-scanner in debug mode for detailed logs..."
    - sonar-scanner -X -Dsonar.projectKey=RohithKonanRavi_southern-Delicious -Dsonar.organization=rohithkonanravi -Dsonar.sources=. -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=4dc5c635c1bcb253d4855f421850974a2b00b91a #magic___^_^___line
  post_build:
    commands:
    - echo "Post-build steps..."
